<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JRI Tracker - Web Dashboard</title>
    <style>
        body { font-family: sans-serif; background: #000; color: #fff; text-align: center; padding: 20px; }
        .data-card { border: 2px solid #333; border-radius: 15px; padding: 20px; margin: 10px; background: #111; }
        #salti { font-size: 80px; color: #00ff00; font-weight: bold; }
        #timer { font-size: 40px; color: #ffff00; }
        #batteria { font-size: 20px; color: #0066ff; }
        button { background: #0066ff; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 20px; cursor: pointer; }
        .status { color: #888; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>JRI TRACKER</h1>
    
    <button id="connect">CONNETTI TRACKER</button>
    <div id="status" class="status">Disconnesso</div>

    <div class="data-card">
        <div>SALTI</div>
        <div id="salti">0</div>
    </div>

    <div class="data-card">
        <div>TEMPO ALLENAMENTO</div>
        <div id="timer">00:00</div>
    </div>

    <div class="data-card">
        <div id="batteria">Batteria Tracker: --</div>
    </div>

    <script>
        connectButton.addEventListener('click', async () => {
    try {
        statusDiv.innerText = "Ricerca in corso...";
        
        // Versione super-compatibile: accetta tutto e dichiara l'UUID
        const device = await navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: [JRI_SERVICE_UUID] 
        });

        statusDiv.innerText = "Connessione a: " + device.name;
        
        const server = await device.gatt.connect();
        statusDiv.innerText = "GATT Connesso, cerco servizio...";
        
        const service = await server.getPrimaryService(JRI_SERVICE_UUID);
        const characteristic = await service.getCharacteristic(JRI_CHAR_UUID);

        statusDiv.innerText = "TUTTO OK! Ricezione dati...";
        connectButton.style.display = 'none';

        characteristic.startNotifications();
        characteristic.addEventListener('characteristicvaluechanged', (event) => {
            const value = new TextDecoder().decode(event.target.value);
            parseData(value);
        });

        // Gestione disconnessione
        device.addEventListener('gattserverdisconnected', () => {
            statusDiv.innerText = "Disconnesso! Ricarica pagina.";
            connectButton.style.display = 'block';
        });

    } catch (error) {
        console.log("ERRORE DETTAGLIATO:", error);
        statusDiv.innerText = "Errore: " + error.message;
    }
});
    </script>
</body>
</html>
